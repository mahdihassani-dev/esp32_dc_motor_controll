<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ESP32 Train Controller App</title>
<style>
  :root {
    --primary: #4a90e2;
    --secondary: #f5f5f5;
    --bg: #1c1c28;
    --card-bg: #2a2a3c;
    --text-color: #ffffff;
    --accent: #50e3c2;
    --active: #50e3c2;
  }
  * { box-sizing: border-box; font-family: "Segoe UI", "Roboto", sans-serif; }
  body { margin:0; padding:0; background: var(--bg); color: var(--text-color); display:flex; flex-direction:column; height:100vh; }
  h1,h2,h3 { margin:0 0 10px 0; }
  .content { flex:1; overflow-y:auto; padding:15px; display:flex; justify-content:center; }
  .card { background: var(--card-bg); border-radius:16px; padding:20px; margin:10px; width:100%; max-width:400px; box-shadow: 0 4px 12px rgba(0,0,0,0.4); display:none; flex-direction:column; }
  .card.active { display:flex; }
  .btn { background: var(--primary); color: var(--text-color); border: none; border-radius: 8px; padding:12px 20px; margin:5px 2px; cursor:pointer; font-size:1rem; transition:0.2s; }
  .btn:hover { background: var(--accent); }
  .btn.active { background: var(--accent); }
  .range { width:100%; margin:10px 0; }
  .status { margin-top:10px; font-weight:bold; font-size:0.95rem; color: var(--accent); }
  label { display:block; margin-top:10px; font-weight:bold; }
  /* Bottom Nav */
  .bottom-nav { display:flex; justify-content:space-around; background: var(--card-bg); padding:10px 0; border-top:1px solid rgba(255,255,255,0.1); }
  .nav-btn { flex:1; text-align:center; color: var(--text-color); font-weight:bold; cursor:pointer; padding:10px 0; transition:0.2s; }
  .nav-btn.active { color: var(--accent); border-top: 2px solid var(--accent); }
</style>
</head>
<body>

<h1 style="text-align:center; padding:10px 0;">üöÇ ESP32 Controller</h1>

<div class="content">
  <!-- Motor Control -->
  <div id="motorCard" class="card active">
    <h3>üéõÔ∏è Motor Control</h3>
    <label for="speed">Speed</label>
    <input type="range" id="speed" class="range" min="0" max="255" value="0" oninput="updateMotor()">
    <label>Direction</label>
    <div>
      <input type="radio" id="forward" name="direction" value="1" checked onchange="updateMotor()">
      <label for="forward">Forward</label>
      <input type="radio" id="backward" name="direction" value="0" onchange="updateMotor()">
      <label for="backward">Backward</label>
    </div>
    <div style="margin-top:10px;">
      <button class="btn" onclick="toggleMotor(true)">Start</button>
      <button class="btn" onclick="toggleMotor(false)">Stop</button>
    </div>
    <div id="motorStatus" class="status">Motor Status: Stopped</div>
  </div>

  <!-- Steam Control -->
  <div id="steamCard" class="card">
    <h3>üå´Ô∏è Steam Control</h3>
    <button class="btn" onclick="setPin15(1)">Activate</button>
    <button class="btn" onclick="setPin15(0)">Deactivate</button>
    <div id="pin15Status" class="status">Steam Status: OFF</div>
  </div>

  <!-- Music Control -->
  <div id="musicCard" class="card">
    <h3>üéµ Music Player</h3>
    <div style="margin-bottom:10px;">
      <button class="btn" onclick="playSong(1)">Track 1</button>
      <button class="btn" onclick="playSong(2)">Track 2</button>
    </div>
    <div style="margin-bottom:10px;">
      <button class="btn" onclick="sendCommand('/pause')">Pause</button>
      <button class="btn" onclick="sendCommand('/stop')">Stop</button>
    </div>
    <label for="volume">Volume</label>
    <input type="range" id="volume" class="range" min="0" max="30" value="15" oninput="setVolume()">
    <div id="musicStatus" class="status">Music Status: Stopped</div>
  </div>
</div>

<!-- Bottom Navigation -->
<div class="bottom-nav">
  <div class="nav-btn active" onclick="showCard('motorCard', this)">Motor</div>
  <div class="nav-btn" onclick="showCard('steamCard', this)">Steam</div>
  <div class="nav-btn" onclick="showCard('musicCard', this)">Music</div>
</div>

<script>
function showCard(cardId, btn){
  document.querySelectorAll('.card').forEach(c=>c.classList.remove('active'));
  document.getElementById(cardId).classList.add('active');
  document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
}

function updateMotor() {
  let speed = document.getElementById("speed").value;
  let dir = document.querySelector('input[name="direction"]:checked').value;
  fetch(`/control?speed=${speed}&direction=${dir}`).then(r=>r.text()).then(d=>document.getElementById("motorStatus").innerText=d);
}
function toggleMotor(run){
  if(!run){ fetch(`/control`).then(r=>r.text()).then(d=>document.getElementById("motorStatus").innerText=d); }
  else{ updateMotor(); }
}
function setPin15(status){
  fetch(`/pin15?status=${status}`).then(r=>r.text()).then(d=>document.getElementById("pin15Status").innerText=d);
}
function playSong(num){
  fetch(`/play?song=${num}`).then(r=>r.text()).then(d=>document.getElementById("musicStatus").innerText=d);
}
function sendCommand(url){
  fetch(url).then(r=>r.text()).then(d=>document.getElementById("musicStatus").innerText=d);
}
function setVolume(){
  let v=document.getElementById("volume").value;
  fetch(`/volume?volume=${v}`).then(r=>r.text()).then(d=>document.getElementById("musicStatus").innerText=d);
}
</script>

</body>
</html>
